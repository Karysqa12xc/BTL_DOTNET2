@model IEnumerable<BTL_DOTNET2.Models.Post>
@using X.PagedList;
@using X.PagedList.Mvc.Core;
@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>
<div class="mt-3 mb-3">
<a asp-action="Create">
    <button type="button"class="btn btn-success">Tạo bài viết mới</button>
</a>
</div>

  <form class="row" asp-controller="Post" asp-action="Index" method="get">
        <p>
            <input placeholder="Nhập từ khoá..." class="col-md-2" type="text" name="searching" />
            <input class="col-md-1" type="submit" value="Tìm kiếm" />
        </p>
    </form>

<div class="row">
    <table class="table col-md-12">
        <thead class="bg-primary text-light">
            <tr>
                <th>
                    Chủ đề
                </th>
                <th>
                    Người đăng
                </th>
                <th>
                    Replies
                </th>
                <th>
                    Thời gian
                </th>
                <th>Lựa chọn</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Count() == 0)
            {
                <h1>Không có dữ liệu</h1>
            }
            @foreach (var item in Model.Reverse())
            {
                    <tr>
                        <td class="d-flex flex-column">
                            <p>
                                @Html.DisplayFor(modelItem => item.Title)
                            </p>
                            <p>
                                <span class="badge @item.Cate.BgColor rounded-pill d-inline">
                                    @Html.DisplayFor(modelItem => item.Cate.CateName) 
                                </span>
                            </p>
                            
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.User!.Email)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CommentTotal)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.PostTime)
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a asp-action="Details" asp-route-id="@item.PostId">
                                    <button type="button" class="btn btn-dark me-3">Xem</button>
                                </a> 
                            @if (item.User == null)
                            {
                                <a asp-controller="ContentPost" asp-action="Delete"
                                    asp-route-id="@item.ContentPost.ContentPostId">
                                        <button type="button" class="btn btn-danger">Xoá</button>
                                </a>    
                            }
                            else
                            {
                                if (@ViewBag.CurrentUser == @item.User || User.IsInRole("SuperAdmin") || User.IsInRole("Admin"))
                                {
                                        <a asp-controller="ContentPost" asp-action="Delete"
                                            asp-route-id="@item.ContentPost.ContentPostId">
                                                <button type="button" class="btn btn-danger">Xoá</button>
                                        </a>     
                                }
                            }
                            </div>
                            

                        </td>
                    </tr>
                

            }
        </tbody>
    </table>

    @using (Html.BeginForm("Index", "Post", FormMethod.Get, new { id = "form1" }))
    {
        @if (Model.Any(p => p.IsChecked))
        {
            <div class="row">
                <div class="col-md-11">
                    @Html.PagedListPager((IPagedList)Model, page =>
                             Url.Action("Index", new { page = page, pagesize = ViewBag.psize }),
                             new X.PagedList.Web.Common.PagedListRenderOptions
            {
                LiElementClasses = new string[] { "page-item" },
                PageClasses = new string[] { "page-link" }
            })
                </div>
                <div class="col-md-1">
                    @Html.DropDownList("pageSize", null, new { @class = "form-select" })
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-md-12">
                    <p>No items to display.</p>
                </div>
            </div>
        }

    }
</div>




    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#pageSize").change(function () {
                $("#form1").submit();
            });
        });
    </script>
